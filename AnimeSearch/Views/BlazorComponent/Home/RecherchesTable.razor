@using AnimeSearch.Models.ViewsModel
@using AnimeSearch.Controllers.api;
@using AnimeSearch.Core

@inject NavigationManager NavManager
@inject AsmsearchContext _database

<BaseTable TabType="Recherche"
           Datas="Tab"
           Columns='Utilities.Tab<TabColumns<Recherche>>(
                new() { Title = "Recherches", Colonnes = (r) => r.recherche, Width = 70 },
                new() { Title = "Nb Recherches", Colonnes = (r) => r.Nb_recherches, Width = 30, TextCenter = true, SortDefault = true, DefaultSortingDescending = true}
            )'
           RowClick="RowClick"
           RowClassSelector='(r) => "tr-search"'/>

@code
{
    [Parameter]
    public string UrlGetDatas { get; set; }

    [Parameter]
    public string UrlSearch { get; set; } = "/";

    private IEnumerable<Recherche> Tab
    {
        get => Task.Run(async () => (await DatabaseCom.GetRecherchesDatas(_database)).OrderByDescending(r => r.Nb_recherches)).GetAwaiter().GetResult();
    }

    private void RowClick(Recherche r)
    {
        NavManager.NavigateTo(UrlSearch + "?q=" + r.recherche, true);
    }
}
