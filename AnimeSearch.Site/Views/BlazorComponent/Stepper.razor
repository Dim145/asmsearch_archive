<link rel="stylesheet" href="lib/bs-stepper/dist/css/bs-stepper.min.css" />

<CascadingValue Value="this">
  @ChildContent
</CascadingValue>

<div id="stepper" class="bs-stepper @(IsVertical ? "vertical" : "")">
  <div class="bs-stepper-header">
    @for (var i = 0; i < Steps.Count; i++)
    {
      int step = i;
      
      <div class="step @(CurrentStep == i ? "active" : "")">
        <button class="btn step-trigger" @onclick="() => SetStep(step)">
          <span class="bs-stepper-circle @(Steps[i].InError ? "text-danger" : i < CurrentStep ? "text-success" : "")">@(step+1)</span>
          <span class="bs-stepper-label @(Steps[i].InError ? "text-danger" : i < CurrentStep ? "text-success" : "")">@Steps[step].Title</span>
        </button>
      </div>
      
      @if (i < Steps.Count - 1)
      {
        <div class="line @(i < CurrentStep ? "bg-primary" : "")" style="width: 5px;"></div>
      }
    }
  </div>
  
  <div class="bs-stepper-content">
    <div class="content fade dstepper-block active">
      @if (Steps.Any())
      {
        @if (Steps[CurrentStep].InError)
        {
          <div class="text-danger form-text">
            @if (Steps[CurrentStep].ErrorMessage != null)
            {
              var tab = Steps[CurrentStep].ErrorMessage.Split("\n");
              
              <ul>
                @foreach (var str in tab.Where(s => !string.IsNullOrWhiteSpace(s)))
                {
                  <li>@str</li>
                }
              </ul>
            }
          </div>
        }
        
        <div>
          @Steps[CurrentStep].ChildContent
        </div>
        
        <div class="text-right">
          @if (CurrentStep > 0)
          {
            <button class="btn btn-primary mr-2" @onclick="Precedent">Precedent</button>
          }
          
          @if (CurrentStep < Steps.Count - 1)
          {
            <button class="btn btn-primary" @onclick="Next">Suivant</button>
          }
          else
          {
            <button class="btn btn-success" @onclick="Finish">Finish</button>
          }
        </div>
      }
    </div>
  </div>
</div>