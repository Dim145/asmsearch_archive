@using AnimeSearch.Data.Models
@using Microsoft.AspNetCore.Mvc.Localization
@model Domains

@inject IViewLocalizer Localizer

@{
    ViewData["title"] = Localizer["title"];

    var nivAcce = ViewData["na"] as int? ?? 0;
}

<style>
    td {
        vertical-align: middle!important;
    }
</style>

<script type="text/javascript" src="~/js/Domaines.min.js"></script>

<div class="container text-white text-center">
    <h1>@Localizer["descr"]</h1>
</div>

<table class="table table-dark table-hover table-striped table-bordered">
    <tr>
        <th>@Localizer["url"]</th>
        <th>@Localizer["state"]</th>
        <th>@Localizer["misc"]</th>
        @if (nivAcce >= DroitDelete)
        {
            <td>@Localizer["action"]</td>
        }
    </tr>


    @if (ViewData["domains"] is Domains[] domains)
    {
        if (domains.Length == 0)
        {
            <tr>
                <td colspan="3" class="text-center">@Localizer["no_domain"]</td>
            </tr>
        }
        else
        {
            foreach (var domain in domains)
            {
                <tr>
                    <td><a href="@domain.Url">@domain.Url</a></td>
                    <td class="text-warning">@Localizer["in_progress"]</td>
                    <td>
                        @foreach (var s in domain.Description?.Split("\n") ?? Array.Empty<string>())
                        {
                            @s <br/>
                        }
                    </td>
                    
                    @if (nivAcce >= DroitDelete)
                    {
                        <td class="text-center">
                            <form asp-controller="Admin" asp-action="DeleteDomain" method="post">
                                <input type="hidden" name="url" value="@domain.Url" class="d-none"/>
                                <button class="btn btn-danger" data-toggle="tooltip" title="@Localizer["delete"]">
                                    <img width="20" src="~/ressources/images/trash.svg" alt="delete"/>
                                </button>
                            </form>
                        </td>
                    }
                </tr>
            }
        }
    }
</table>

@if (nivAcce >= DroitAdd)
{
    <div class="w-100 text-white">
        <p class="text-danger">@Html.ValidationMessage("bad_domain")</p>
        <p>@Localizer["add_domain"]:</p>

        <form method="post">
            <input class="form-control" asp-for="Url" type="url" required="required"/> <br/>
            <textarea class="form-control" asp-for="Description" required="required"></textarea> <br/>
            <input type="submit" value="@Localizer["valider"]" class="btn btn-success"/>
        </form>
    </div>
}