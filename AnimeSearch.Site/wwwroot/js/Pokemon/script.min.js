function throwBall(n,t,i){Ball.savePosition();anime({targets:["#ball"],translateY:{value:n*-.5+"px",duration:400,easing:"easeInOutSine"},translateX:{value:-t*.25,duration:400,easing:"linear"},scale:{value:1-.25*i,easing:"easeInSine",duration:400},complete:determineThrowResult})}function determineThrowResult(){var t=getCenterCoords("target"),i=getCenterCoords("ball"),n=document.getElementById("target").getBoundingClientRect().width/2,r;i.x>t.x-n&&i.x<t.x+n&&i.y>t.y-n&&i.y<t.y+n?(Ball.savePosition(),r=i.x<t.x?-1:1,anime({targets:["#ball"],translateY:{value:-1.15*n,duration:200,easing:"linear"},translateX:{value:1.15*n*r,duration:200,easing:"linear"},scaleX:{value:r,duration:200},complete:function(){var n=Ball.getElement();n.style.backgroundImage="url('"+Resources.pokeballActive+"')";emitParticlesToPokeball()}})):setTimeout(resetState,400)}function emitParticlesToPokeball(){for(var t,u=getCenterCoords("target"),o=Ball.getElement(),f=o.getBoundingClientRect(),i,r,e=["#E4D3A8","#6EB8C0","#FFF","#2196F3"],s=document.getElementById("particles"),n=0;n<50;n++)t=document.createElement("div"),t.className="particle",t.setAttribute("id","particle-"+n),i=getRandNum(-60,60)+u.x,t.style.left=i+"px",r=getRandNum(-60,60)+u.y,t.style.top=r+"px",t.style.backgroundColor=e[getRandNum(0,e.length)],s.appendChild(t),anime({targets:["#particle-"+n],translateX:{value:f.left-i,delay:100+n*10},translateY:{value:f.top+Ball.size/2-r,delay:100+n*10},opacity:{value:0,delay:100+n*10,duration:800,easing:"easeInSine"}}),anime({targets:["#target"],opacity:{value:0,delay:200,easing:"easeInSine"}});setTimeout(function(){var n=Ball.getElement();n.style.backgroundImage="url('"+Resources.pokeballClosed+"')";document.getElementById("particles").innerHTML="";Ball.savePosition();anime({targets:["#ball"],translateY:{value:"200px",delay:400,duration:400,easing:"linear"},complete:function(){Ball.resetBall()}});setTimeout(function(){animateCaptureState();resetState()},750)},1e3)}function animateCaptureState(){var t=document.getElementById("capture-screen"),n;t.classList.toggle("hidden");n=500;anime({targets:["#capture-ball"],rotate:40,duration:n,easing:"easeInOutBack",loop:!0,direction:"alternate"});var i=document.getElementById("ring-active").getBoundingClientRect(),r=(150-i.width)/150*100,u=getRandNum(0,100);setTimeout(function(){var f,t,i,n;anime.remove("#capture-ball");u<Math.floor(r)?(f=document.getElementById("capture-ball"),t=document.getElementById("capture-ball-button-container"),t.classList.toggle("hidden"),n=document.getElementById("capture-status"),n.classList.toggle("hidden"),n.innerHTML="Vous avez attrapé Dialga!",makeItRainConfetti(),anime({targets:["#capture-ball-button-container"],opacity:{value:0,duration:800,easing:"easeInSine"},complete:function(){setTimeout(function(){var t=document.getElementById("capture-screen"),n;t.classList.toggle("hidden");n=document.getElementById("capture-ball-button-container");n.classList.toggle("hidden");n.style.opacity="";document.getElementById("capture-status").classList.toggle("hidden")},800)}})):(i=document.getElementById("poof-container"),i.classList.toggle("hidden"),n=document.getElementById("capture-status"),n.innerHTML="Dialga s'est échappé!",n.classList.toggle("hidden"),anime({targets:["#poof"],scale:{value:20,delay:400,easing:"linear",duration:600},complete:function(){var r=document.getElementById("capture-screen"),n,t,i;r.classList.toggle("hidden");n=document.getElementById("poof");n.style.transform="";t=document.getElementById("poof-container");t.classList.toggle("hidden");i=document.getElementById("capture-status");i.classList.toggle("hidden")}}))},n*6)}function makeItRainConfetti(){for(var i,n,t=0;t<100;t++)i=document.getElementById("capture-confetti"),n=document.createElement("div"),n.className="particle",n.setAttribute("id","particle-"+t),particleLeft=window.innerWidth/2,n.style.left=particleLeft+"px",particleTop=window.innerHeight/2,n.style.top=particleTop+"px",n.style.backgroundColor=getRandNum(0,2)?"#FFF":"#4aa6fb",i.appendChild(n),anime({targets:["#particle-"+t],translateX:{value:(getRandNum(0,2)?-1:1)*getRandNum(0,window.innerWidth/2),delay:100},translateY:{value:(getRandNum(0,2)?-1:1)*getRandNum(0,window.innerHeight/2),delay:100},opacity:{value:0,duration:800,easing:"easeInSine"},complete:function(){document.getElementById("capture-confetti").innerHTML=""}})}function toggleInfoScreen(){var n=document.getElementById("info-screen"),t=document.getElementById("info-button");n.classList.toggle("hidden");t.innerHTML=n.className==="hidden"?"?":"X"}function resetState(){Ball.resetBall();document.getElementById("target").style.opacity=1;var n=document.getElementById("ring-fill");n.style.height="150px";n.style.width="150px";anime({targets:["#ring-fill"],height:"5px",width:"5px",duration:3e3,loop:!0,easing:"linear"})}function getCenterCoords(n){var t=document.getElementById(n).getBoundingClientRect();return{x:t.left+t.width/2,y:t.top+t.height/2}}function getRandNum(n,t){return Math.floor(Math.random()*(t-n))+n}var Screen={height:window.innerHeight,width:window.innerWidth},MAX_VELOCITY=Screen.height*.009,Resources={pokeball:"/ressources/images/pkmngo-pokeball.png",pokeballActive:"/ressources/images/pkmngo-pokeballactive.png",pokeballClosed:"/ressources/images/pkmngo-pokeballclosed.png"},Ball={id:"ball",size:50,x:0,y:0,inMotion:!1,moveBall:function(n,t){Ball.x=n;Ball.y=t;var i=document.getElementById(Ball.id);i.style.top=Ball.y+"px";i.style.left=Ball.x+"px"},getElement:function(){return document.getElementById(Ball.id)},resetBall:function(){Ball.moveBall(Screen.width/2-Ball.size/2,Screen.height-(Ball.size+10));var n=document.getElementById(Ball.id);n.style.transform="";n.style.width=n.style.height=Ball.size+"px";n.style.backgroundImage="url('"+Resources.pokeball+"')";Ball.inMotion=!1},savePosition:function(){var n=document.getElementById("ball"),t=n.getBoundingClientRect();n.style.transform="";n.style.top=t.top+"px";n.style.left=t.left+"px";n.style.height=n.style.width=t.width+"px"}};resetState();anime({targets:["#target"],rotate:20,duration:800,loop:!0,easing:"easeInOutQuad",direction:"alternate"});window.onresize=function(){Screen.height=window.innerHeight;Screen.width=window.innerWidth;MAX_VELOCITY=Screen.height*.009;resetState()};var touchElement=document.getElementById("touch-layer"),touchRegion=new ZingTouch.Region(touchElement),CustomSwipe=new ZingTouch.Swipe({escapeVelocity:.1}),CustomPan=new ZingTouch.Pan,endPan=CustomPan.end;CustomPan.end=function(n){return setTimeout(function(){Ball.inMotion===!1&&Ball.resetBall()},100),endPan.call(this,n)};touchRegion.bind(touchElement,CustomPan,function(n){Ball.moveBall(n.detail.events[0].x-Ball.size/2,n.detail.events[0].y-Ball.size/2)});touchRegion.bind(touchElement,CustomSwipe,function(n){Ball.inMotion=!0;var u=document.getElementById("screen"),f=u.getBoundingClientRect(),e=n.detail.data[0].currentDirection,h=velocity=n.detail.data[0].velocity;velocity=velocity>MAX_VELOCITY?MAX_VELOCITY:velocity;var t=Math.log(velocity+1)/Math.log(MAX_VELOCITY+1),o=Screen.height-Screen.height*t+f.top,i=o-n.detail.events[0].y,s=-.75*Screen.height*t,r=1*(90-e)*-(s/100);anime.remove("#ring-fill");anime({targets:["#ball"],translateX:{duration:300,value:r,easing:"easeOutSine"},translateY:{value:i*1.25+"px",duration:300,easing:"easeOutSine"},scale:{value:1-.5*t,easing:"easeInSine",duration:300},complete:function(){i<0?throwBall(i,r,t):setTimeout(resetState,400)}})});