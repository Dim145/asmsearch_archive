function randomSelection(n){return Array.isArray(n)?n[Math.floor(Math.random()*n.length)]:n}class LiveWidget{static #LiveModel=null;static getLiveModel(n={waifuPath:"",cdnPath:""},t=""){return LiveWidget.#LiveModel==null&&(LiveWidget.#LiveModel=new LiveWidget,LiveWidget.#LiveModel.#init(n,t)),LiveWidget.#LiveModel}#modelList=null;#messageTimer=0;#CDNPath="";#toggle=null;#config=null;#isOn=true;constructor(){}#init(n,t){typeof n=="string"&&(n={waifuPath:n,apiPath:t});this.#config=n;document.body.insertAdjacentHTML("beforeend",`<div id="waifu-toggle">
			<span>Revient !</span>
		</div>`);this.#toggle=document.getElementById("waifu-toggle");this.#toggle.addEventListener("click",this.toggle.bind(this));localStorage.getItem("waifu-display")&&Date.now()-localStorage.getItem("waifu-display")<=864e5?(this.#toggle.setAttribute("first-time",!0),this.#isOn=!1,setTimeout(()=>{this.#toggle.classList.add("waifu-toggle-active")},0)):(this.#isOn=!0,this.#loadWidget(n))}toggle(){this.#isOn=!this.#isOn;this.#isOn?(this.#toggle.classList.remove("waifu-toggle-active"),this.#toggle.getAttribute("first-time")?(this.#loadWidget(this.#config),this.#toggle.removeAttribute("first-time")):(localStorage.removeItem("waifu-display"),document.getElementById("waifu").style.display="",setTimeout(()=>{document.getElementById("waifu").style.bottom="55px"},0))):(localStorage.setItem("waifu-display",Date.now()),this.showMessage("Au revoir !",2e3,11),document.getElementById("waifu").style.bottom="-1000px",setTimeout(()=>{document.getElementById("waifu").style.display="none",document.getElementById("waifu-toggle").classList.add("waifu-toggle-active")},3e3))}#loadWidget(n){let{waifuPath:h,apiPath:f,cdnPath:i}=n;const t=document.getElementById("liveConf");if(typeof i=="string")i.endsWith("/")||(i+="/");else if(typeof f=="string")f.endsWith("/")||(f+="/");else{console.error("Invalid initWidget argument!");return}this.#CDNPath=i;localStorage.removeItem("waifu-display");sessionStorage.removeItem("waifu-text");document.body.insertAdjacentHTML("beforeend",`<div id="waifu">
			<div id="waifu-tips"></div>
			<canvas id="live2d" width="800" height="800"></canvas>
            <div id="waifu-tool" style="right: -10px;">
				<span class="fa fa-lg fa-street-view"></span>
				<span class="fa fa-lg fa-info-circle"></span>
				<span class="fa fa-lg fa-times"></span>
			</div>
		</div>`);setTimeout(()=>{var n=document.getElementById("waifu"),i=document.getElementById("live2d"),r=document.getElementById("waifu-tool");n.style.bottom="61px";n.style.left=0;i.style.width="300px";i.style.height="300px";t!=undefined&&(n.style.left=t.style.left,n.style.right=t.style.right,t.style.right!=""&&(r.style.left="-10px",r.style.right=""),t.style.bottom!=""&&(n.style.bottom=t.style.bottom),i.style.height=t.style.height,i.style.width=t.style.width)},0);let r=!1,u=0,o=["Cela fait longtemps, les jours sont passés si vite...","J'ai failli m'ennuyer","Tu es parti ? &#x1F622;","Surtout ne revient jamais !","N'oubliez pas de mettre Adblock sur liste blanche !"];window.addEventListener("mousemove",()=>r=!0);window.addEventListener("keydown",()=>r=!0);setInterval(()=>{r?(r=!1,clearInterval(u),u=null):u||(u=setInterval(()=>{this.showMessage(randomSelection(o),6e3,9)},2e4))},1e3);this.#registerEventListener();this.welcomeMessage();let e=localStorage.getItem("modelId"),s=localStorage.getItem("modelTexturesId");e===null&&(e=5,s=2);this.loadModel(e,s);fetch(h).then(n=>n.json()).then(n=>{window.addEventListener("mouseover",t=>{for(let{selector:r,text:i}of n.mouseover)if(t.target.matches(r)){i=randomSelection(i);i=i.replace("{text}",t.target.innerText);i=i.replace("{title}",t.target.title);this.showMessage(i,4e3,8);return}}),window.addEventListener("click",t=>{for(let{selector:r,text:i}of n.click)if(t.target.matches(r)){i=randomSelection(i);i=i.replace("{text}",t.target.innerText);this.showMessage(i,4e3,8);return}}),n.seasons.forEach(({date:n,text:t})=>{var r,u,n;const i=new Date,f=n.split("-")[0],e=n.split("-")[1]||f;f.split("/")[0]<=i.getMonth()+1&&i.getMonth()+1<=e.split("/")[0]&&f.split("/")[1]<=i.getDate()&&i.getDate()<=e.split("/")[1]&&(t=randomSelection(t),t=t.replace("{year}",i.getFullYear()),r=t.indexOf("|age-"),r>=0&&(u=t.indexOf("|",r+1),u>=0&&(n=t.substring(r+5,u),t=t.substring(0,r)+(i.getFullYear()-n)+t.substring(u+1))),this.showMessage(t,7e3,100),o.push(t))})})}welcomeMessage(){let n;if(location.pathname==="/"){const t=(new Date).getHours();n=t>5&&t<=7?"Une bonne journée est sur le point de commencer. (Même si il est encore un peu tôt)":t>7&&t<=11?"Good morning ! Le travail se passe bien, ne restez pas assis, levez-vous et marchez !":t>11&&t<=13?"Bon Appétit !":t>13&&t<=17?null:t>17&&t<=19?"C'est le soir ! La vue du coucher de soleil à l'extérieur est magnifique, la plus belle chose est le coucher de soleil rouge.":t>19&&t<=21?null:t>21&&t<=23?"Tu vas commencer à regarder quelque chose à cette heure-là .":"Est-tu un vampire &#x1F628; ? <br/> Tu es debout si tard, tu peux te lever demain matin ?"}else n=`Bienvenue sur la page <span>「${document.title.split(" - ")[0]}」</span>`;n!=null&&this.showMessage(n,7e3,8)}async loadModelList(){const n=await fetch(`${this.#CDNPath}model_list.json`);this.#modelList=await n.json()}async loadModel(n,t,i){localStorage.setItem("modelId",n);localStorage.setItem("modelTexturesId",t);this.showMessage(i,4e3,10);this.#modelList||await this.loadModelList();const r=randomSelection(this.#modelList.models[n]);loadlive2d("live2d",`${this.#CDNPath}model/${r}/index.json`)}async loadRandModel(){const n=localStorage.getItem("modelId"),i=localStorage.getItem("modelTexturesId");this.#modelList||await this.loadModelList();const t=randomSelection(this.#modelList.models[n]);loadlive2d("live2d",`${this.#CDNPath}model/${t}/index.json`);this.showMessage("random model？",4e3,10)}async loadOtherModel(){let n=localStorage.getItem("modelId");this.#modelList||await this.loadModelList();const t=++n>=this.#modelList.models.length?0:n;this.loadModel(t,0,this.#modelList.messages[t])}#registerEventListener(){window.addEventListener("copy",()=>{this.showMessage("Qu'avez-vous copié ? N'oubliez pas d'ajouter la source !",6e3,9)});window.addEventListener("visibilitychange",()=>{document.hidden||this.showMessage("Wow, tu es enfin de retour.",6e3,9)});document.querySelector("#waifu-tool .fa-street-view").addEventListener("click",this.loadOtherModel.bind(this));document.querySelector("#waifu-tool .fa-times").addEventListener("click",this.toggle.bind(this));document.querySelector("#waifu-tool .fa-info-circle").addEventListener("click",()=>{SwalFire({icon:"info",title:"Live2D infos",html:'<p>Lien git des créteurs: <a target="_blank" href="https://github.com/stevenjoezhang/live2d-widget">https://github.com/stevenjoezhang/live2d-widget<\/a><\/p><p>Lien du git de certains model 2D: <a target="_blank" href="https://github.com/DomathID/live2d-model">https://github.com/DomathID/live2d-model<\/a><\/p>'})})}showMessage(n,t,i){if(n&&(!sessionStorage.getItem("waifu-text")||!(sessionStorage.getItem("waifu-text")>i))){this.#messageTimer&&(clearTimeout(this.#messageTimer),this.#messageTimer=null);n=randomSelection(n);sessionStorage.setItem("waifu-text",i);const r=document.getElementById("waifu-tips");r.innerHTML=n;r.classList.add("waifu-tips-active");this.#messageTimer=setTimeout(()=>{sessionStorage.removeItem("waifu-text"),r.classList.remove("waifu-tips-active")},t)}}}